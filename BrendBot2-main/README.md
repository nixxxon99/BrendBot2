
# BrendBot (refactored)

**–ß—Ç–æ –Ω–æ–≤–æ–≥–æ:**
- –ú–æ–¥—É–ª—å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ (routers / services / keyboards / middlewares / data)
- –ö–∞—Ç–∞–ª–æ–≥ –±—Ä–µ–Ω–¥–æ–≤ –≤ `data/catalog.json` –≤–º–µ—Å—Ç–æ —Ö–∞—Ä–¥–∫–æ–¥–∞
- –§–∞–∑–∑–∏-–ø–æ–∏—Å–∫ –ø–æ –±—Ä–µ–Ω–¥–∞–º –∏ —Å–∏–Ω–æ–Ω–∏–º–∞–º (`rapidfuzz`)
- –ë–µ–∑–æ–ø–∞—Å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —á–µ—Ä–µ–∑ `.env` –∏ `pydantic-settings`
- –ó–∞–ø–∞—Å–Ω–æ–π in-memory Redis, –µ—Å–ª–∏ Redis –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω

## –ó–∞–ø—É—Å–∫

1. –°–æ–∑–¥–∞–π `.env` –Ω–∞ –æ—Å–Ω–æ–≤–µ `.env.example` –∏ –∑–∞–ø–æ–ª–Ω–∏ —Ç–æ–∫–µ–Ω—ã:
```
cp .env.example .env
# –∑–∞—Ç–µ–º –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π .env
```

2. –£—Å—Ç–∞–Ω–æ–≤–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:
```
pip install -r requirements.txt
```

3. –ó–∞–ø—É—Å—Ç–∏ (webhook):
```
python main.py
```

> –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é —Å–µ—Ä–≤–µ—Ä —Å–ª—É—à–∞–µ—Ç `0.0.0.0:10000`. –£–∫–∞–∂–∏ `WEBHOOK_URL` (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Å Render/NGROK), —á—Ç–æ–±—ã –±–æ—Ç —É—Å—Ç–∞–Ω–æ–≤–∏–ª –≤–µ–±—Ö—É–∫.

## –ö–∞–∫ –¥–æ–±–∞–≤–∏—Ç—å –±—Ä–µ–Ω–¥
–î–æ–±–∞–≤—å –æ–±—ä–µ–∫—Ç –≤ `data/catalog.json`:
```json
"New Brand": {
  "category": "–í–∏—Å–∫–∏",
  "photo_file_id": "FILE_ID",
  "caption": "<b>New Brand</b>\n‚Ä¢ –ü—É–Ω–∫—Ç—ã –æ–ø–∏—Å–∞–Ω–∏—è",
  "aliases": ["–ø—Å–µ–≤–¥–æ–Ω–∏–º1", "alias2"]
}
```
–ö–∞—Ç–µ–≥–æ—Ä–∏–∏: `–í–∏—Å–∫–∏`, `–í–æ–¥–∫–∞`, `–ü–∏–≤–æ`, `–í–∏–Ω–æ`, `–õ–∏–∫—ë—Ä`.

## –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ
–ò–≥—Ä—ã/—Ç–µ—Å—Ç—ã –∏ AI-–ø–æ–º–æ—â–Ω–∏–∫ –ø–æ–∫–∞ –Ω–µ –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω—ã ‚Äî –∏—Ö –º–æ–∂–Ω–æ –≤—ã–Ω–µ—Å—Ç–∏ –æ—Ç–¥–µ–ª—å–Ω—ã–º–∏ —Ä–æ—É—Ç–µ—Ä–∞–º–∏ –ø–æ –∞–Ω–∞–ª–æ–≥–∏–∏.


---
## Smart upgrade (–∞–≤–≥—É—Å—Ç 2025)
- RAG —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–∏—Å–∫ (`app/services/rag.py`) ‚Äî –∏—Å–ø–æ–ª—å–∑—É–µ—Ç OpenAI embeddings (–µ—Å–ª–∏ –µ—Å—Ç—å `OPENAI_API_KEY`) –∏–ª–∏ `rapidfuzz` –∫–∞–∫ —Ä–µ–∑–µ—Ä–≤.
- Sales Playbook (`app/services/playbook.py`) ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –ø–æ–¥—Å–∫–∞–∑–æ–∫ –ø–æ –∞–ø—Å–µ–π–ª—É/–∫—Ä–æ—Å—Å‚Äë—Å–µ–π–ª—É.
- –ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏—è (`app/services/personalize.py`) ‚Äî —Ä–æ–ª—å/—Ä–µ–≥–∏–æ–Ω/—Ç–∏–ø –¢–¢ (Redis –ª–∏–±–æ `data/user_prefs.json`).
- –§–æ—Ç–æ‚Äë–∞–Ω–∞–ª–∏–∑ (`app/services/vision.py`, `app/routers/vision.py`) ‚Äî –∑–∞–≥–ª—É—à–∫–∞, –ª–µ–≥–∫–æ –ø–æ–¥–∫–ª—é—á–∏—Ç—å Google Vision / CLIP.
- –ö–≤–∏–∑—ã (`app/routers/quiz.py`) ‚Äî –±—ã—Å—Ç—Ä—ã–µ –≤–æ–ø—Ä–æ—Å—ã –ø–æ –±—Ä–µ–Ω–¥–∞–º –∏–∑ `data/catalog.json`.

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
- `OPENAI_API_KEY` ‚Äî –¥–ª—è —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏—Ö —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤.
- `REDIS_URL` –∏–ª–∏ –ª–æ–∫–∞–ª—å–Ω—ã–π Redis (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ).

### –ö–∞–∫ –≤–∫–ª—é—á–∏—Ç—å Vision
–û—Ç–∫—Ä–æ–π `app/services/vision.py` –∏ –ø–æ–¥–∫–ª—é—á–∏ –±–∏–±–ª–∏–æ—Ç–µ–∫—É (–Ω–∞–ø—Ä–∏–º–µ—Ä, `google-cloud-vision`). –í–µ—Ä–Ω–∏ —Å–ø–∏—Å–æ–∫ –±—Ä–µ–Ω–¥–æ–≤ –ø–æ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—é —Ç–µ–∫—Å—Ç–∞/—ç—Ç–∏–∫–µ—Ç–æ–∫ ‚Äî –æ—Å—Ç–∞–ª—å–Ω–æ–µ —É–∂–µ –≥–æ—Ç–æ–≤–æ.


### –°–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π –∏–Ω–¥–µ–∫—Å –±–µ–∑ OpenAI
- –ò–Ω–¥–µ–∫—Å —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ `data/` –∏ —Å—Ç—Ä–æ–∏—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ.
- –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è TF‚ÄëIDF (scikit‚Äëlearn). –ï—Å–ª–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω `sentence-transformers`, –º–æ–∂–Ω–æ –≤–∫–ª—é—á–∏—Ç—å SBERT —á–µ—Ä–µ–∑ `SBERT_MODEL`.
- –°–æ–±—Ä–∞—Ç—å –∏–Ω–¥–µ–∫—Å: `python tools/build_semantic_index.py` (TF‚ÄëIDF) –∏–ª–∏ `python tools/build_semantic_index.py --sbert`.


### –ê–¥–º–∏–Ω –∏ —É—Ç–∏–ª–∏—Ç—ã
- `/reindex [--sbert]` ‚Äî –ø–µ—Ä–µ—Å–±–æ—Ä–∫–∞ —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–æ–≥–æ –∏–Ω–¥–µ–∫—Å–∞ (TF‚ÄëIDF –∏–ª–∏ SBERT).
- `/validate_kb` ‚Äî –ø—Ä–æ—Å—Ç–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è KB —Ñ–∞–π–ª–æ–≤.
- `/lang ru|kk` ‚Äî –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —è–∑—ã–∫–∞ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ (–ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞).

### POSM-—Ç—Ä–µ–∫–µ—Ä
- –ö–Ω–æ–ø–∫–∞ **üì¶ POSM —Å–ø–∏—Å–∞–Ω–∏–µ** ‚Äî –º–∏–Ω–∏-–º–∞—Å—Ç–µ—Ä –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è.
- –≠–∫—Å–ø–æ—Ä—Ç CSV: –∫–æ–º–∞–Ω–¥–∞ `/posm_export`.

### –≠–∫—Å–ø–æ—Ä—Ç –∫–∞—Ä—Ç–æ—á–µ–∫ –≤ PDF
- –ö–Ω–æ–ø–∫–∞ –≤ –∫–∞—Ä—Ç–æ—á–∫–µ **–≠–∫—Å–ø–æ—Ä—Ç PDF** ‚Äî —Å–æ–∑–¥–∞—ë—Ç PDF –≤ `data/export/` –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –≤ —á–∞—Ç.

### –ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è –≤ –∫–∞—Ä—Ç–æ—á–∫–µ
- **–ö–∞–∫ –ø—Ä–æ–¥–∞–≤–∞—Ç—å** ‚Äî –ª–æ–∫–∞–ª—å–Ω—ã–π playbook —Å —É—á—ë—Ç–æ–º –ø—Ä–æ—Ñ–∏–ª—è.
- **–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞** ‚Äî –ø–æ—Ö–æ–∂–∏–µ –±—Ä–µ–Ω–¥—ã.

## üöÄ –†–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏–µ –Ω–∞ Render (Blueprint)
1) –§–æ—Ä–∫–Ω–∏/–∑–∞–≥—Ä—É–∑–∏ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π —Å —ç—Ç–∏–º –∫–æ–¥–æ–º.
2) –í–∫–ª—é—á–∏ **Blueprints** –≤ Render –∏ –Ω–∞–∂–º–∏ **New +** ‚Üí **Blueprint** ‚Üí —É–∫–∞–∂–∏ —Å—Å—ã–ª–∫—É –Ω–∞ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π.
3) Render —Å—á–∏—Ç–∞–µ—Ç `render.yaml` –∏ —Å–æ–∑–¥–∞—Å—Ç **Worker**‚Äë—Å–µ—Ä–≤–∏—Å.
4) –í —Å–µ—Ä–≤–∏—Å–µ ‚Üí **Environment** –¥–æ–±–∞–≤—å:
   - `BOT_TOKEN` ‚Äî —Ç–æ–∫–µ–Ω –±–æ—Ç–∞ –∏–∑ @BotFather
   - `TIMEZONE` ‚Äî `Asia/Almaty` (–º–æ–∂–Ω–æ –æ—Å—Ç–∞–≤–∏—Ç—å –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
5) –ù–∞–∂–º–∏ **Deploy**. –í—Å—ë!

–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞: —Å–æ–∑–¥–∞–π—Ç–µ Worker –≤—Ä—É—á–Ω—É—é –∏ —É–∫–∞–∂–∏ Start Command: `python main.py`.
